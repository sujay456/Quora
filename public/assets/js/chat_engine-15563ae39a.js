class Chatengine{constructor(e,t,s){this.chatbox=$("."+e),this.username=t,this.userEmail=s,this.currentRoom=s,this.socket=io.connect("http://localhost:5000"),this.userEmail&&this.connectHandler()}connectHandler(){let e=this;this.socket.on("connect",(function(){console.log("Connection established using sockets..."),e.socket.emit("online",{user_name:e.username,user_email:e.userEmail}),e.socket.on("up",(function(e){console.log("You are online",e)})),e.socket.emit("join-room",{user_name:e.username,chatroom:e.userEmail})})),this.socket.on("user-joined",(function(e){console.log("You have joined ur room",e)})),$(".user").click(()=>{$("#chat-messages-list li").remove();let t=$(event.target).attr("userEmail");e.currentRoom=t,e.socket.emit("join-room",{user_name:e.username,chatroom:e.currentRoom}),openChat()}),$("#message-form").submit(()=>{event.preventDefault();let t=event.target[0].value;event.target.reset(),""!=t&&e.socket.emit("send_message",{message:t,user_name:e.username,user_email:e.userEmail,chatroom:e.currentRoom})});let t=0;this.socket.on("recieve-message",(function(s){if(e.currentRoom!=s.user_email&&s.user_email!=e.userEmail){$("audio")[0].play(),t+=1;let e=`<div id="newnoti" class="animate__animated animate__pulse" >${t}</div>`;$(".notification").append(e);$("<li>");let o="New  Message from "+s.user_name;return void $.ajax({type:"post",url:"/notification/create?email="+s.user_email,data:{mssg:o},success:function(e){},error:function(e){console.log("Error",e.responseText)}})}let o=$("<li>"),a="other animate__animated animate__backInLeft";s.user_email==e.userEmail&&(a="mine animate__animated animate__backInUp");let n="<span>"+s.message+"</span>";o.append(n),o.addClass(a),$("#chat-messages-list").append(o),setTimeout(()=>{var e=document.querySelector("#chat-messages-list");e.scrollTop=e.scrollHeight-e.clientHeight},700)}))}}